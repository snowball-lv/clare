

require "fileutils"


task :default do
    
    puts
    Dir.chdir("bin") do
        
        glue = "../cli-tests/example.c"
        
        src = "../cli-tests/example.a.ir"
        asm = "cli-tests/example.asm"
        obj = "cli-tests/example.o"
        bin = "cli-tests/example"
        
        FileUtils.mkdir_p("cli-tests")
        
        sh "./clare -i #{src} -f clare-ir -b i386 -o #{asm}"
        sh "nasm -f elf32 #{asm} -o #{obj}"
        sh "tcc #{obj} #{glue} -o #{bin}"
        sh "./#{bin}"
        
        puts
        Dir["*.dot"].each do |dot|
            sh "dot #{dot} -T jpg > #{dot.ext('jpg')}"
        end
    end
end
