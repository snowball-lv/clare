

static void MANGLE(Munch)(Node *root) {
    
    int _test_id = 0;
    int _matched_id = 0;
    
    #define return      ret =
    #define RULE(test_body, action) {       \
        _test_id++;                         \
        int ret = 0; test_body; if (ret) {  \
            _matched_id = _test_id;         \
            goto EXECUTE_ACTION;            \
        }                                   \
    }
    
        #include RULE_FILE
    
    #undef RULE
    #undef return
    
    EXECUTE_ACTION:;
    
    int _action_id = 0;
    
    #define MUNCH(node)     MANGLE(Munch)(node)
    #define RULE(test_body, action) {       \
        _action_id++;                       \
        if (_action_id == _matched_id) {    \
            action;                         \
            return;                         \
        }                                   \
    }
    
        #include RULE_FILE
    
    #undef RULE
    #undef MUNCH
}
