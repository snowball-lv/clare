

// #define RULE(pattern, action)

RULE(Nodes.Seq(0, 0), {
    MUNCH(root->kids[0]);
    MUNCH(root->kids[1]);
})

RULE(Nodes.Mov(Nodes.Tmp(), 0), {
    Node *dst = root->kids[0];
    MUNCH(root->kids[1]);
    vm_store(dst->index);
})

RULE(Nodes.Tmp(), {
    vm_load(root->index);
})

RULE(Nodes.Add(0, 0), {
    MUNCH(root->kids[0]);
    MUNCH(root->kids[1]);
    vm_add();
})

RULE(Nodes.I32(0), {
    vm_push(root->i32);
})
